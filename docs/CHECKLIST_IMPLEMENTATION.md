# Чеклист для проверки реализации исправлений и рекомендаций

**Дата создания:** 2025-12-29

## Критические исправления

### 1. Переключение вкладки при запуске парсера
- [ ] Запустить парсинг с главной страницы
- [ ] Проверить, что вкладка браузера НЕ переключается на страницу поисковика
- [ ] Проверить, что вкладка переключается ТОЛЬКО при обнаружении CAPTCHA
- [ ] Проверить, что после решения CAPTCHA парсинг продолжается

**Команды для проверки:**
```bash
# 1. Запустить все сервисы
cd backend && uvicorn app.main:app --reload
cd parser_service && python -m uvicorn api:app --reload --port 9003
cd frontend/moderator-dashboard-ui && npm run dev

# 2. Открыть http://localhost:3000
# 3. Запустить парсинг с ключевым словом
# 4. Проверить, что вкладка браузера не переключается
```

**Ожидаемый результат:**
- Вкладка браузера остается на странице модератора
- Вкладка переключается только при обнаружении CAPTCHA
- После решения CAPTCHA парсинг продолжается

### 2. Прогрессбар парсинга
- [ ] Запустить парсинг с главной страницы
- [ ] Проверить, что прогрессбар отображается
- [ ] Проверить, что прогрессбар показывает анимацию при статусе "running"
- [ ] Проверить, что отображается количество найденных URL (если доступно)
- [ ] Проверить, что после завершения парсинга прогрессбар скрывается

**Команды для проверки:**
```bash
# 1. Открыть http://localhost:3000
# 2. Запустить парсинг
# 3. Проверить прогрессбар на главной странице
```

**Ожидаемый результат:**
- Прогрессбар отображается с анимацией при статусе "running"
- Отображается количество найденных URL (если доступно)
- Прогрессбар скрывается после завершения парсинга

### 3. Автоматический переход после завершения парсинга
- [ ] Запустить парсинг с главной страницы
- [ ] Дождаться завершения парсинга
- [ ] Проверить, что происходит автоматический переход на страницу результатов
- [ ] Проверить, что на странице результатов отображаются все данные

**Команды для проверки:**
```bash
# 1. Открыть http://localhost:3000
# 2. Запустить парсинг
# 3. Дождаться завершения
# 4. Проверить автоматический переход
```

**Ожидаемый результат:**
- После завершения парсинга происходит автоматический переход на `/parsing-runs/{runId}`
- На странице результатов отображаются все данные

## Оптимизация производительности

### 4. Кэширование данных поставщиков и blacklist
- [ ] Открыть страницу `/keywords`
- [ ] Проверить, что данные загружаются из кэша (если доступны)
- [ ] Проверить, что кэш обновляется при изменениях
- [ ] Проверить, что кэш инвалидируется при добавлении/удалении из blacklist
- [ ] Проверить, что кэш инвалидируется при создании поставщика

**Команды для проверки:**
```bash
# 1. Открыть http://localhost:3000/keywords
# 2. Открыть DevTools (F12) → Application → Local Storage
# 3. Проверить наличие ключей cached_suppliers и cached_blacklist
# 4. Добавить домен в blacklist
# 5. Проверить, что кэш обновился
```

**Ожидаемый результат:**
- Данные кэшируются в localStorage
- Кэш обновляется при изменениях
- Кэш инвалидируется при добавлении/удалении из blacklist

### 5. Пагинация для ключей
- [ ] Открыть страницу `/keywords`
- [ ] Проверить, что отображается пагинация (если ключей больше 10)
- [ ] Проверить, что можно переключаться между страницами
- [ ] Проверить, что отображается правильное количество ключей на странице

**Команды для проверки:**
```bash
# 1. Открыть http://localhost:3000/keywords
# 2. Проверить наличие пагинации
# 3. Переключиться между страницами
```

**Ожидаемый результат:**
- Пагинация отображается, если ключей больше 10
- Можно переключаться между страницами
- Отображается правильное количество ключей

### 6. Ленивая загрузка URL для ключей
- [ ] Открыть страницу `/keywords`
- [ ] Проверить, что URL не загружаются при загрузке страницы
- [ ] Раскрыть ключ в accordion
- [ ] Проверить, что URL загружаются только при раскрытии
- [ ] Проверить, что URL не загружаются повторно при повторном раскрытии

**Команды для проверки:**
```bash
# 1. Открыть http://localhost:3000/keywords
# 2. Открыть DevTools (F12) → Network
# 3. Проверить, что запросы к /domains/queue не выполняются при загрузке
# 4. Раскрыть ключ
# 5. Проверить, что запросы выполняются только при раскрытии
```

**Ожидаемый результат:**
- URL не загружаются при загрузке страницы
- URL загружаются только при раскрытии accordion
- URL не загружаются повторно при повторном раскрытии

### 7. Индексы в БД
- [ ] Применить миграцию `006_add_performance_indexes.sql`
- [ ] Проверить, что индексы созданы
- [ ] Проверить, что запросы выполняются быстрее

**Команды для проверки:**
```bash
# 1. Применить миграцию
psql -U postgres -d database -f backend/migrations/006_add_performance_indexes.sql

# 2. Проверить индексы
psql -U postgres -d database -c "\d domains_queue"
psql -U postgres -d database -c "\d moderator_suppliers"
psql -U postgres -d database -c "\d moderator_blacklist"
```

**Ожидаемый результат:**
- Индексы созданы на всех указанных полях
- Запросы выполняются быстрее

## Улучшение UX

### 8. Улучшение UX прогрессбара
- [ ] Запустить парсинг
- [ ] Проверить, что отображается количество найденных URL
- [ ] Проверить, что прогрессбар имеет анимацию
- [ ] Проверить, что визуальное отображение улучшено

**Команды для проверки:**
```bash
# 1. Открыть http://localhost:3000
# 2. Запустить парсинг
# 3. Проверить прогрессбар
```

**Ожидаемый результат:**
- Отображается количество найденных URL
- Прогрессбар имеет анимацию
- Визуальное отображение улучшено

### 9. Оптимизация фильтрации blacklist
- [ ] Открыть страницу `/parsing-runs/{runId}`
- [ ] Проверить, что blacklist загружается из кэша
- [ ] Проверить, что фильтрация работает быстро
- [ ] Проверить, что используется Set для поиска

**Команды для проверки:**
```bash
# 1. Открыть http://localhost:3000/parsing-runs/{runId}
# 2. Проверить DevTools → Network
# 3. Проверить, что blacklist загружается из кэша
```

**Ожидаемый результат:**
- Blacklist загружается из кэша
- Фильтрация работает быстро
- Используется Set для поиска

### 10. Улучшение обработки ошибок (retry механизм)
- [ ] Остановить backend
- [ ] Выполнить API запрос
- [ ] Проверить, что запрос повторяется до 3 раз
- [ ] Проверить, что ошибка обрабатывается корректно

**Команды для проверки:**
```bash
# 1. Остановить backend
# 2. Открыть http://localhost:3000
# 3. Выполнить действие, требующее API запрос
# 4. Проверить DevTools → Console
# 5. Проверить, что запрос повторяется
```

**Ожидаемый результат:**
- Запрос повторяется до 3 раз при временных ошибках
- Ошибка обрабатывается корректно
- Пользователю показывается понятное сообщение

### 11. Улучшение группировки доменов
- [ ] Открыть страницу `/parsing-runs/{runId}`
- [ ] Проверить, что есть поиск по доменам
- [ ] Проверить, что есть сортировка (по количеству URL, по алфавиту)
- [ ] Проверить, что есть фильтрация по статусу (поставщики, реселлеры, новые)

**Команды для проверки:**
```bash
# 1. Открыть http://localhost:3000/parsing-runs/{runId}
# 2. Проверить наличие поиска, сортировки и фильтрации
# 3. Протестировать все функции
```

**Ожидаемый результат:**
- Поиск по доменам работает
- Сортировка работает (по количеству URL, по алфавиту)
- Фильтрация по статусу работает

### 12. Автоматическое обновление данных
- [ ] Открыть страницу `/keywords`
- [ ] Проверить, что данные обновляются автоматически каждые 30 секунд
- [ ] Проверить, что отображается индикатор количества ключей

**Команды для проверки:**
```bash
# 1. Открыть http://localhost:3000/keywords
# 2. Дождаться 30 секунд
# 3. Проверить, что данные обновились
```

**Ожидаемый результат:**
- Данные обновляются автоматически каждые 30 секунд
- Отображается индикатор количества ключей

## Общая проверка

### Тестирование всех страниц
- [ ] Главная страница (`/`) - работает корректно
- [ ] Страница ключей (`/keywords`) - работает корректно
- [ ] Страница деталей парсинга (`/parsing-runs/{runId}`) - работает корректно
- [ ] Страница blacklist (`/blacklist`) - работает корректно

### Проверка ошибок
- [ ] Нет ошибок в консоли браузера (F12)
- [ ] Нет ошибок в логах backend
- [ ] Нет ошибок в логах parser service

### Проверка производительности
- [ ] Время загрузки страниц улучшено
- [ ] Запросы к API выполняются быстрее
- [ ] Кэширование работает корректно

## Команды для полной проверки

```bash
# 1. Запустить все сервисы
cd backend && uvicorn app.main:app --reload
cd parser_service && python -m uvicorn api:app --reload --port 9003
cd frontend/moderator-dashboard-ui && npm run dev

# 2. Применить миграцию БД
psql -U postgres -d database -f backend/migrations/006_add_performance_indexes.sql

# 3. Проверить индексы
psql -U postgres -d database -c "\d domains_queue"
psql -U postgres -d database -c "\d moderator_suppliers"

# 4. Открыть браузер
# http://localhost:3000

# 5. Проверить все функции согласно чеклисту выше
```

## Ожидаемые результаты

После выполнения всех проверок:
- ✅ Все критические исправления работают
- ✅ Все рекомендации реализованы
- ✅ Производительность улучшена
- ✅ UX улучшен
- ✅ Нет ошибок в консоли и логах





