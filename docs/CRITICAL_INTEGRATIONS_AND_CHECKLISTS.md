# –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —á–µ–∫–ª–∏—Å—Ç—ã

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞, –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç —á–µ–∫–ª–∏—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π.**

**üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã:**
- **–ì–ª–∞–≤–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**: [`docs/MASTER_INSTRUCTION.md`](MASTER_INSTRUCTION.md)
- **–ë–∏–±–ª–∏—è –æ—à–∏–±–æ–∫**: [`docs/TROUBLESHOOTING.md`](TROUBLESHOOTING.md)
- **–ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã**: [`.cursorrules`](../.cursorrules)

---

## –ß–∞—Å—Ç—å 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. Blacklist —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

#### –û–ø–∏—Å–∞–Ω–∏–µ
–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤ –∏–∑ blacklist –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–µ–∑–¥–µ, –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞. –î–æ–º–µ–Ω—ã, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ blacklist, –¥–æ–ª–∂–Ω—ã **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ–∑–∞—Ç—å** –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ø–æ–º–µ—á–∞—Ç—å—Å—è.

#### –ú–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**1.1 –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/app/parsing-runs/[runId]/page.tsx`
- **–§—É–Ω–∫—Ü–∏—è:** `loadData()` (—Å—Ç—Ä–æ–∫–∏ 112-119)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - Blacklist **–≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–≤–µ–∂–∏–º** (–Ω–µ –∏–∑ –∫—ç—à–∞) –¥–ª—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–ü–ï–†–ï–î –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π** –¥–æ–º–µ–Ω–æ–≤
  - –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–º–µ–Ω–∞ –≤ blacklist –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `invalidateBlacklistCache()` –∏ `loadData()`

**1.2 –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ - –∑–∞–≥—Ä—É–∑–∫–∞ URL**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/app/keywords/page.tsx`
- **–§—É–Ω–∫—Ü–∏—è:** `loadUrlsForKeyword()` (—Å—Ç—Ä–æ–∫–∏ 190-204)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
  - Blacklist **–≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–≤–µ–∂–∏–º** (–Ω–µ –∏–∑ –∫—ç—à–∞)
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–ü–ï–†–ï–î –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π** –¥–æ–º–µ–Ω–æ–≤
  - –ö—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö

#### –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω—ã:**
   ```typescript
   extractRootDomain(domain).toLowerCase()
   ```

2. **–í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–µ–∂–∏–π blacklist –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
   ```typescript
   // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à
   const cachedBlacklist = getCachedBlacklist()
   
   // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–µ–∂–∏–π
   const blacklistResult = await getBlacklist({ limit: 1000 })
   setCachedBlacklist(blacklistResult.entries) // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
   ```

3. **–§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ü–ï–†–ï–î –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π:**
   ```typescript
   // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π
   const filtered = domainsData.entries.filter(...)
   const grouped = groupByDomain(filtered)
   ```

4. **–ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ blacklist:**
   ```typescript
   await addToBlacklist({ domain, parsingRunId: runId })
   invalidateBlacklistCache() // –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞
   await loadData() // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
   ```

#### –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ `/parsing-runs/[runId]` - –¥–æ–º–µ–Ω—ã –∏—Å—á–µ–∑–∞—é—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ `/keywords` - –¥–æ–º–µ–Ω—ã –∏—Å—á–µ–∑–∞—é—Ç –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–æ–º–µ–Ω–æ–≤ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Ä–µ–≥–∏—Å—Ç—Ä, –ø–æ–¥–¥–æ–º–µ–Ω—ã)

---

### 2. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ–º–µ–Ω–æ–≤ (Supplier/Reseller)

#### –û–ø–∏—Å–∞–Ω–∏–µ
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –¥–æ–º–µ–Ω–æ–≤ (–ü–æ—Å—Ç–∞–≤—â–∏–∫/–†–µ—Å–µ–ª–ª–µ—Ä) –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –±–∞–∑—ã `moderator_suppliers`.

#### –ú–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**2.1 –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/app/parsing-runs/[runId]/page.tsx`
- **–§—É–Ω–∫—Ü–∏—è:** `loadData()` (—Å—Ç—Ä–æ–∫–∏ 121-136, 139-165)
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∏ 439-444

**2.2 –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/app/keywords/page.tsx`
- **–§—É–Ω–∫—Ü–∏—è:** `loadUrlsForKeyword()` (—Å—Ç—Ä–æ–∫–∏ 173-180, 195-200)
- **–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ:** –°—Ç—Ä–æ–∫–∏ 357-366

#### –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω—ã –ø—Ä–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–∏:**
   ```typescript
   const rootDomain = extractRootDomain(supplier.domain).toLowerCase()
   suppliersMap.set(rootDomain, { type: supplier.type, id: supplier.id })
   ```

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Map –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞:**
   ```typescript
   const suppliersMap = new Map<string, { type: "supplier" | "reseller"; id: number }>()
   ```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–µ —Ü–≤–µ—Ç–∞ –±–µ–π–¥–∂–µ–π:**
   - –ü–æ—Å—Ç–∞–≤—â–∏–∫: `bg-green-600 hover:bg-green-700 text-white`
   - –†–µ—Å–µ–ª–ª–µ—Ä: `bg-purple-600 hover:bg-purple-700 text-white`

#### –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ `/parsing-runs/[runId]` - —Å—Ç–∞—Ç—É—Å—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ `/keywords` - —Å—Ç–∞—Ç—É—Å—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–º–µ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ —Ü–≤–µ—Ç–∞ –±–µ–π–¥–∂–µ–π –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ ID –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

### 3. –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–æ–º–µ–Ω–æ–≤ (`groupByDomain`)

#### –û–ø–∏—Å–∞–Ω–∏–µ
–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ URL –ø–æ –∫–æ—Ä–Ω–µ–≤—ã–º –¥–æ–º–µ–Ω–∞–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ `groupByDomain` –∏–∑ `lib/utils-domain.ts`.

#### –ú–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**3.1 –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/app/parsing-runs/[runId]/page.tsx`
- **–§—É–Ω–∫—Ü–∏—è:** `loadData()` (—Å—Ç—Ä–æ–∫–∞ 139)

**3.2 –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/app/keywords/page.tsx`
- **–§—É–Ω–∫—Ü–∏—è:** `loadUrlsForKeyword()` (—Å—Ç—Ä–æ–∫–∏ 207-222)

#### –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω—ã –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏:**
   ```typescript
   const rootDomain = extractRootDomain(entry.domain).toLowerCase()
   ```

2. **–°–æ—Ö—Ä–∞–Ω—è—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:**
   ```typescript
   const rootDomain = extractRootDomain(entry.domain).toLowerCase()
   const displayDomain = extractRootDomain(entry.domain) // –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π
   ```

3. **–í–∫–ª—é—á–∞—Ç—å source –≤ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É:**
   ```typescript
   group.urls.push({
     url: entry.url,
     keyword: entry.keyword,
     source: entry.source, // –í–∞–∂–Ω–æ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞
   })
   ```

#### –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –¥–æ–º–µ–Ω—ã –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è (mc.ru –ø–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Ä–µ–≥–∏—Å—Ç—Ä, –ø–æ–¥–¥–æ–º–µ–Ω—ã)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ source –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ `/parsing-runs/[runId]` –∏ `/keywords`

---

### 4. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–ª—è –¥–æ–º–µ–Ω–æ–≤ (Google/–Ø–Ω–¥–µ–∫—Å)

#### –û–ø–∏—Å–∞–Ω–∏–µ
–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (Google/–Ø–Ω–¥–µ–∫—Å) –¥–ª—è –¥–æ–º–µ–Ω–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ `parsing_logs`. –ë–µ–π–¥–∂–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç, –∫–∞–∫–æ–π –ø–æ–∏—Å–∫–æ–≤–∏–∫ —Ä–µ–∞–ª—å–Ω–æ –Ω–∞—à–µ–ª URL –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞.

**‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `parsing_logs` –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, –∞ –Ω–µ `source` –∏–∑ –ë–î.

**üìö –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** [`docs/SOURCE_DETERMINATION_FLOW.md`](SOURCE_DETERMINATION_FLOW.md)

#### –ú–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**4.1 –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞ - –±–µ–π–¥–∂–∏ –¥–æ–º–µ–Ω–æ–≤**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/app/parsing-runs/[runId]/page.tsx`
- **–§—É–Ω–∫—Ü–∏—è:** `loadData()` –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ `AccordionTrigger` (—Å—Ç—Ä–æ–∫–∏ 255-266, 583-592)

**4.2 –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/lib/utils-domain.ts`
- **–§—É–Ω–∫—Ü–∏—è:** `collectDomainSources()` (—Å—Ç—Ä–æ–∫–∏ 110-161)

#### –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å parsing_logs –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤:**
   ```typescript
   // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å parsing_logs
   const sources = collectDomainSources(group.urls, parsingLogsForSources)
   ```

2. **–ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å URL –ø–µ—Ä–µ–¥ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ–º:**
   ```typescript
   const normalizedUrl = normalizeUrl(urlEntry.url)
   ```

3. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–µ —Ü–≤–µ—Ç–∞ –±–µ–π–¥–∂–µ–π:**
   - Google: `bg-blue-100 text-blue-700 border-blue-300`
   - –Ø–Ω–¥–µ–∫—Å: `bg-yellow-100 text-yellow-700 border-yellow-300`

#### –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ parsing_logs –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å –¥–∞–Ω–Ω—ã–º–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ collectDomainSources –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Å parsing_logs
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –±–µ–π–¥–∂–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ–º–µ–Ω–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è URL —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ —Ü–≤–µ—Ç–∞ –±–µ–π–¥–∂–µ–π –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã

---

### 5. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Suppliers, Blacklist)

#### –û–ø–∏—Å–∞–Ω–∏–µ
–ö–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤ –∏ blacklist –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ API –∑–∞–ø—Ä–æ—Å–æ–≤.

#### –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **Blacklist –≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–≤–µ–∂–∏–º –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:**
   ```typescript
   // ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à
   const cachedBlacklist = getCachedBlacklist()
   
   // ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –í—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å–≤–µ–∂–∏–π
   const blacklistResult = await getBlacklist({ limit: 1000 })
   setCachedBlacklist(blacklistResult.entries) // –û–±–Ω–æ–≤–ª—è–µ–º –∫—ç—à
   ```

2. **–ü–æ—Å—Ç–∞–≤—â–∏–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ –∫—ç—à–∞:**
   ```typescript
   const cachedSuppliers = getCachedSuppliers()
   if (cachedSuppliers) {
     // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—ç—à
   } else {
     // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏ –∫—ç—à–∏—Ä—É–µ–º
     const suppliersResult = await getSuppliers({ limit: 1000 })
     setCachedSuppliers(suppliersResult.suppliers)
   }
   ```

3. **–ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π:**
   ```typescript
   await addToBlacklist({ domain })
   invalidateBlacklistCache() // –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è
   await loadData() // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞
   ```

#### –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ blacklist –≤—Å–µ–≥–¥–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–≤–µ–∂–∏–º –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –∫—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –∫—ç—à –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–∑ –∫—ç—à–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ –∫—ç—à–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (5 –º–∏–Ω—É—Ç)

---

### 6. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö (Polling)

#### –û–ø–∏—Å–∞–Ω–∏–µ
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —á–µ—Ä–µ–∑ polling (setInterval).

#### –ú–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**6.1 –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (Dashboard)**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/app/page.tsx`
- **–§—É–Ω–∫—Ü–∏—è:** Polling –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ (—Å—Ç—Ä–æ–∫–∏ 49-111)

**6.2 –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤**
- **–§–∞–π–ª:** `frontend/moderator-dashboard-ui/app/keywords/page.tsx`
- **–§—É–Ω–∫—Ü–∏—è:** Polling –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (—Å—Ç—Ä–æ–∫–∏ 42-45)

#### –ü—Ä–∞–≤–∏–ª–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–û—á–∏—â–∞—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏:**
   ```typescript
   useEffect(() => {
     const interval = setInterval(() => {
       loadData()
     }, 30000)
     
     return () => clearInterval(interval) // –û—á–∏—Å—Ç–∫–∞
   }, [])
   ```

2. **–û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å polling –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö:**
   ```typescript
   if (!parsingProgress.isRunning || !parsingProgress.runId) return
   ```

3. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –ø—Ä–∏ polling:**
   ```typescript
   try {
     await loadData()
   } catch (error) {
     console.error("Error in polling:", error)
     // –ù–µ –ø—Ä–µ—Ä—ã–≤–∞—Ç—å polling –ø—Ä–∏ –æ—à–∏–±–∫–µ
   }
   ```

#### –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª –æ—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ polling –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –æ—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º

---

## –ß–∞—Å—Ç—å 2: –ß–µ–∫–ª–∏—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

- [ ] –ü—Ä–æ—á–∏—Ç–∞–Ω —Ä–∞–∑–¥–µ–ª "–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏" –¥–ª—è –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ù–∞–π–¥–µ–Ω—ã –≤—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ
- [ ] –ü–æ–Ω—è—Ç–Ω–æ, –∫–∞–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏–µ —á–∞—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –Ω–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Ä–µ—à–µ–Ω–∏—è–º–∏

#### –ü–æ–∏—Å–∫ –≤—Å–µ—Ö –º–µ—Å—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- [ ] –í—ã–ø–æ–ª–Ω–µ–Ω –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ –¥–ª—è –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ù–∞–π–¥–µ–Ω—ã –≤—Å–µ —Ñ–∞–π–ª—ã, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –≥–¥–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –≤—Å–µ API –≤—ã–∑–æ–≤—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å—é

---

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

#### –û–±—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –∫–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –Ω–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω–æ, —á—Ç–æ –Ω–µ—Ç TypeScript –æ—à–∏–±–æ–∫

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü

**–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ (`/`)**
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ú–µ—Ç—Ä–∏–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç (–µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–∏–º–æ)
- [ ] –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞ (`/parsing-runs/[runId]`)**
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Blacklist —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–æ–º–µ–Ω—ã –∏—Å—á–µ–∑–∞—é—Ç)
- [ ] –°—Ç–∞—Ç—É—Å—ã –¥–æ–º–µ–Ω–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ü–æ—Å—Ç–∞–≤—â–∏–∫/–†–µ—Å–µ–ª–ª–µ—Ä)
- [ ] –ò—Å—Ç–æ—á–Ω–∏–∫–∏ URL –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (Google/–Ø–Ω–¥–µ–∫—Å)
- [ ] –î–µ–π—Å—Ç–≤–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç (–î–æ–±–∞–≤–∏—Ç—å –≤ Blacklist, –°–æ–∑–¥–∞—Ç—å –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞)
- [ ] –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ (`/keywords`)**
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Blacklist —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç (–¥–æ–º–µ–Ω—ã –∏—Å—á–µ–∑–∞—é—Ç)
- [ ] –°—Ç–∞—Ç—É—Å—ã –¥–æ–º–µ–Ω–æ–≤ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–ü–æ—Å—Ç–∞–≤—â–∏–∫/–†–µ—Å–µ–ª–ª–µ—Ä)
- [ ] –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –¥–æ–º–µ–Ω–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (–Ω–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤)
- [ ] –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ URL —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (polling)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

**–°—Ç—Ä–∞–Ω–∏—Ü–∞ blacklist (`/blacklist`)**
- [ ] –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫
- [ ] –°–ø–∏—Å–æ–∫ blacklist –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ blacklist —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ö—ç—à –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞

#### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

**Backend**
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö Backend (`logs/Backend-*.log`)
- [ ] API –∑–∞–ø—Ä–æ—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**Parser Service**
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö Parser Service (`logs/Parser Service-*.log`)
- [ ] –ü–∞—Ä—Å–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**Frontend**
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ Network tab (—Å—Ç–∞—Ç—É—Å 200/204 –¥–ª—è —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ CORS

#### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

```powershell
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—Ç–æ–≤
netstat -ano | findstr ":8000 :9003 :3000 :9222"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health endpoints
curl http://127.0.0.1:8000/health
curl http://127.0.0.1:9003/health
curl http://localhost:3000

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤ (Backend)
python temp/backend/check_imports.py

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö
Get-Content "logs\Backend-*.log" -Tail 50 | Select-String -Pattern "ERROR|Exception|Traceback"
```

---

## –ß–∞—Å—Ç—å 3: –ß–µ–∫–ª–∏—Å—Ç—ã –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π

### ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—é—Ç —Ç–∞–±–ª–∏—Ü—ã –∏–ª–∏ —Å–æ–∑–¥–∞—é—Ç SERIAL –ø–æ–ª—è, **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!

### üö® –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–û–í–ï–†–ö–ò –î–õ–Ø AI-–ê–ì–ï–ù–¢–ê

**–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π SQL AI-–∞–≥–µ–Ω—Ç –û–ë–Ø–ó–ê–ù:**

1. ‚úÖ **–ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º:** –ó–∞–ø—É—Å—Ç–∏—Ç—å `scripts/validate-migration.ps1` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏
2. ‚úÖ **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω `backend/migrations/TEMPLATE_with_sequence.sql`
3. ‚úÖ **–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏:** –ó–∞–ø—É—Å—Ç–∏—Ç—å `scripts/check-sequences-after-migration.ps1 -TableName <table_name>`
4. ‚úÖ **–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `BaseRepository` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
5. ‚úÖ **–ü—Ä–∏ –∫–æ–º–º–∏—Ç–µ:** Pre-commit hook –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

**–ï—Å–ª–∏ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ - –∑–∞–¥–∞—á–∞ –ù–ï —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω–æ–π!**

### –ü–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏

- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –±—É–¥–µ—Ç –ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã —Å SERIAL –ø–æ–ª—è–º–∏
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å, –±—É–¥–µ—Ç –ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å SERIAL –ø–æ–ª—è–º–∏
- [ ] –ò–∑—É—á–∏—Ç—å —à–∞–±–ª–æ–Ω `backend/migrations/TEMPLATE_with_sequence.sql`

### –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

- [ ] –ï—Å–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ - –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –ï—Å–ª–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è SERIAL –ø–æ–ª–µ - –¥–æ–±–∞–≤–∏—Ç—å –≤—ã–¥–∞—á—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω `TEMPLATE_with_sequence.sql` –∫–∞–∫ –æ—Å–Ω–æ–≤—É
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –∏–º–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π (—Å —Å—É—Ñ—Ñ–∏–∫—Å–∞–º–∏ _seq, _seq1 –∏ —Ç.–¥.)

### –ü–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é:
  ```powershell
  .\scripts\validate-migration.ps1 -MigrationFile "backend\migrations\XXX_migration.sql"
  ```
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–∞)
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –º–∏–≥—Ä–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:
  - –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–µ—Å–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞)
  - –í—ã–¥–∞—á—É –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π:
  ```powershell
  .\scripts\check-sequences-after-migration.ps1 -TableName "table_name"
  ```
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–º–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π:
  ```powershell
  $env:PGPASSWORD="Jnvnszoe5971312059001"
  psql -U postgres -d b2bplatform -h localhost -p 5432 -c "SELECT sequence_name FROM information_schema.sequences WHERE sequence_name LIKE '%table_name%';"
  ```
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
  ```powershell
  psql -U postgres -d b2bplatform -h localhost -p 5432 -c "\dp table_name_id_seq"
  ```
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö

### –ï—Å–ª–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞

1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:**
   ```sql
   ALTER SEQUENCE wrong_name_id_seq RENAME TO correct_name_id_seq;
   ```

2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:**
   ```sql
   GRANT ALL PRIVILEGES ON SEQUENCE sequence_name TO postgres;
   GRANT ALL PRIVILEGES ON SEQUENCE sequence_name TO PUBLIC;
   ALTER SEQUENCE sequence_name OWNER TO postgres;
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é** –¥–ª—è –±—É–¥—É—â–∏—Ö –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–π
4. **–ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å** –≤ `docs/TROUBLESHOOTING.md`

---

## –ß–∞—Å—Ç—å 4: FAQ –ø–æ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º PostgreSQL

### –û–±—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã

**–ß—Ç–æ —Ç–∞–∫–æ–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å (sequence) –≤ PostgreSQL?**

–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å - —ç—Ç–æ –æ–±—ä–µ–∫—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —á–∏—Å–ª–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. –í PostgreSQL –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –ø–æ–ª—è—Ö —Ç–∏–ø–∞ `SERIAL` –∏–ª–∏ `BIGSERIAL`.

**–ü–æ—á–µ–º—É –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ—à–∏–±–∫–∏ —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—è–º–∏?**

–û—à–∏–±–∫–∏ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –∏–∑-–∑–∞:
1. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è** - –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–æ–∂–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è —Å–æ —Å—Ç–∞—Ä—ã–º –∏–º–µ–Ω–µ–º
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏** - –º–∏–≥—Ä–∞—Ü–∏—è –Ω–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏–ª–∏ –Ω–µ –≤—ã–¥–∞–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

**–û—à–∏–±–∫–∞: `InsufficientPrivilegeError: –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏`**

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –∏–º–µ–µ—Ç –ø—Ä–∞–≤ –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```sql
GRANT ALL PRIVILEGES ON SEQUENCE sequence_name TO postgres;
GRANT ALL PRIVILEGES ON SEQUENCE sequence_name TO PUBLIC;
ALTER SEQUENCE sequence_name OWNER TO postgres;
```

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `BaseRepository` - –æ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ `scripts/check-sequences-after-migration.ps1 -TableName <table_name>`

**–û—à–∏–±–∫–∞: –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –∏–º–µ–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∏–º—è**

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Å—Ç–∞–ª–∞—Å—å —Å–æ —Å—Ç–∞—Ä—ã–º –∏–º–µ–Ω–µ–º.

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å
ALTER SEQUENCE old_name_id_seq RENAME TO new_name_id_seq;

-- –í—ã–¥–∞—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
GRANT ALL PRIVILEGES ON SEQUENCE new_name_id_seq TO postgres;
GRANT ALL PRIVILEGES ON SEQUENCE new_name_id_seq TO PUBLIC;
ALTER SEQUENCE new_name_id_seq OWNER TO postgres;
```

### –†–∞–±–æ—Ç–∞ —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏

**–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é —Å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ–º —Ç–∞–±–ª–∏—Ü—ã?**

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —à–∞–±–ª–æ–Ω `backend/migrations/TEMPLATE_with_sequence.sql`
2. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
   ```sql
   ALTER SEQUENCE old_table_name_id_seq RENAME TO new_table_name_id_seq;
   ```
3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –≤—ã–¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
   ```sql
   GRANT ALL PRIVILEGES ON SEQUENCE new_table_name_id_seq TO postgres;
   GRANT ALL PRIVILEGES ON SEQUENCE new_table_name_id_seq TO PUBLIC;
   ALTER SEQUENCE new_table_name_id_seq OWNER TO postgres;
   ```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º?**

```powershell
.\scripts\validate-migration.ps1 -MigrationFile "backend\migrations\XXX_migration.sql"
```

**–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏?**

```powershell
.\scripts\check-sequences-after-migration.ps1 -TableName "table_name"
```

### –†–∞–±–æ—Ç–∞ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏

**–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BaseRepository?**

```python
from app.adapters.db.base_repository import BaseRepository

class MyRepository(BaseRepository):
    async def create(self, data: dict):
        try:
            entry = MyModel(**data)
            self.session.add(entry)
            await self.session.flush()
            return entry
        except Exception as e:
            # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π
            if await self._handle_sequence_error(e, "my_table"):
                # –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                entry = MyModel(**data)
                self.session.add(entry)
                await self.session.flush()
                return entry
            raise
```

**–ö–∞–∫–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å BaseRepository?**

–í—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º–∏ `SERIAL` –∏–ª–∏ `BIGSERIAL` –ø–æ–ª—è:
- `DomainQueueRepository` ‚úÖ (—É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç)
- –î—Ä—É–≥–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å SERIAL –ø–æ–ª—è–º–∏

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```powershell
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
.\scripts\validate-migration.ps1 -MigrationFile "backend\migrations\XXX_migration.sql"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
.\scripts\check-sequences-after-migration.ps1 -TableName "table_name"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—Ä—É—á–Ω—É—é
$env:PGPASSWORD="Jnvnszoe5971312059001"
psql -U postgres -d b2bplatform -h localhost -p 5432 -c "SELECT sequence_name FROM information_schema.sequences WHERE sequence_name LIKE '%table_name%';"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
psql -U postgres -d b2bplatform -h localhost -p 5432 -c "\dp table_name_id_seq"
```

---

## –û–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ —Ç–æ—á–∫–∞–º–∏

### –ü–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º

1. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ—á–∏—Ç–∞–π —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç** –¥–ª—è –∑–∞—Ç—Ä–æ–Ω—É—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
2. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω–∞–π–¥–∏ –≤—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫ –ø–æ –∫–æ–¥–æ–≤–æ–π –±–∞–∑–µ
3. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∏—Å–ø–æ–ª—å–∑—É–π –µ–¥–∏–Ω—ã–π –ø–æ–¥—Ö–æ–¥** –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö
4. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å –≤—Å–µ –º–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

1. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –≤—ã–ø–æ–ª–Ω–∏ —á–µ–∫–ª–∏—Å—Ç –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ "–ß–µ–∫–ª–∏—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π"**
2. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–∑–º–µ–Ω–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
3. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**, –µ—Å–ª–∏ –æ–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
4. **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–æ–≤–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**, –µ—Å–ª–∏ –æ–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

### –ó–∞–ø—Ä–µ—â–µ–Ω–æ

- –ú–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –¥–ª—è –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–ª–∏—è–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à blacklist –ø—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–∞—Ä—Å–∏–Ω–≥–∞
- –§–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å blacklist –ø–æ—Å–ª–µ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ (–≤—Å–µ–≥–¥–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ–¥ –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π)

---

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ SQLAlchemy

### –ü—Ä–∞–≤–∏–ª–∞ —Ä–∞–±–æ—Ç—ã —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏

**1. –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (Repository pattern):**
- ‚úÖ **–¢–æ–ª—å–∫–æ `flush()`** - –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫ –∫–æ–º–º–∏—Ç—É
- ‚ùå **–ù–∏–∫–æ–≥–¥–∞ `commit()`** - —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- ‚úÖ **–í–æ–∑–≤—Ä–∞—â–∞—é—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏** - —É—Å–ø–µ—Ö/–Ω–µ—É–¥–∞—á–∞ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–æ–º

**2. –†–æ—É—Ç–µ—Ä—ã (Endpoints):**
- ‚úÖ **–û–¥–∏–Ω `commit()` –∏–ª–∏ `rollback()`** –Ω–∞ –≤–µ—Å—å endpoint
- ‚úÖ **–û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π** - —Å `rollback()` –≤ `except` –±–ª–æ–∫–∞—Ö
- ‚úÖ **–Ø–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–µ–π** - –Ω–∞—á–∞–ª–æ –∏ –∫–æ–Ω–µ—Ü –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ

**3. `get_db()` dependency:**
- ‚úÖ **–¢–æ–ª—å–∫–æ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏** - –±–µ–∑ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- ‚úÖ **Rollback –Ω–µ–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π** - –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–æ–º–º–∏—Ç–æ–≤
- ‚ùå **–ù–∏–∫–æ–≥–¥–∞ `commit()`** - –Ω–µ –¥–æ–ª–∂–µ–Ω –≤–ª–∏—è—Ç—å –Ω–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

**‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–¥–≤–æ–π–Ω–æ–π –∫–æ–º–º–∏—Ç):**
```python
# Repository
async def delete(self, domain: str) -> bool:
    await self.session.delete(entry)
    await self.session.commit()  # ‚ùå –î–≤–æ–π–Ω–æ–π –∫–æ–º–º–∏—Ç!
    return True

# Router  
async def delete_endpoint(domain: str, db: AsyncSession = Depends(get_db)):
    await repo.delete(domain)
    await db.commit()  # ‚ùå –í—Ç–æ—Ä–æ–π –∫–æ–º–º–∏—Ç!
```

**‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–æ–¥–∏–Ω –∫–æ–º–º–∏—Ç –≤ —Ä–æ—É—Ç–µ—Ä–µ):**
```python
# Repository
async def delete(self, domain: str) -> bool:
    await self.session.delete(entry)
    await self.session.flush()  # ‚úÖ –¢–æ–ª—å–∫–æ flush
    return True

# Router
async def delete_endpoint(domain: str, db: AsyncSession = Depends(get_db)):
    try:
        await repo.delete(domain)
        await db.commit()  # ‚úÖ –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–æ–º–º–∏—Ç
    except Exception:
        await db.rollback()  # ‚úÖ Rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ
        raise
```

### –ß–µ–∫–ª–∏—Å—Ç –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–æ–ª—å–∫–æ `flush()`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ä–æ—É—Ç–µ—Ä—ã –¥–µ–ª–∞—é—Ç –æ–¥–∏–Ω `commit()` –∏–ª–∏ `rollback()`
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `get_db()` –Ω–µ –¥–µ–ª–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–º–∏—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Å `rollback()`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ API
- [ ] –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î

### –°–≤—è–∑–∞–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
- **–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ blacklist –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:** –°–º. `docs/TROUBLESHOOTING.md` —Ä–∞–∑–¥–µ–ª "–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ blacklist –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
- **–û—à–∏–±–∫–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π PostgreSQL:** –°–º. `docs/CRITICAL_INTEGRATIONS_AND_CHECKLISTS.md` —á–∞—Å—Ç—å 3

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2026-01-04






