# Рекомендации по улучшению работы AI-агента

**Дата создания:** 2025-12-29  
**Цель:** Повысить эффективность работы AI-агента, уменьшить участие пользователя в диагностике и настройке работоспособности, улучшить понимание структуры проекта.

## Обзор

Этот документ содержит рекомендации по улучшению работы AI-агента для:
1. Лучшей диагностики и проверки результатов на фронтенде
2. Улучшения понимания структуры проекта
3. Автоматизации процесса работы
4. Минимизации участия пользователя в диагностике

## 1. Улучшение диагностики и проверки результатов на фронтенде

### 1.1 Автоматическая проверка состояния сервисов перед началом работы

**Проблема:** AI-агент часто начинает работу без проверки состояния системы, что приводит к ошибкам и необходимости участия пользователя.

**Решение:**
- **ОБЯЗАТЕЛЬНО** запускать `.\scripts\quick-check.ps1 all` перед началом любой задачи
- Проверять состояние всех сервисов (Backend, Frontend, Parser Service, Chrome CDP)
- Если сервисы не запущены - запускать их автоматически или предупреждать пользователя

**Команды для проверки:**
```powershell
# Проверка всех сервисов
.\scripts\quick-check.ps1 all

# Проверка отдельных сервисов
curl http://127.0.0.1:8000/health  # Backend
curl http://127.0.0.1:9003/health  # Parser Service
curl http://localhost:3000          # Frontend
curl http://127.0.0.1:9222/json/version  # Chrome CDP
```

**Правило:** Перед началом ЛЮБОЙ задачи проверять состояние системы.

### 1.2 Обязательная проверка результатов на реальном фронтенде после изменений

**Проблема:** AI-агент часто заявляет, что задача выполнена, не проверив результаты на реальном фронтенде.

**Решение:**
- **ОБЯЗАТЕЛЬНО** проверять результаты на реальном фронтенде после ЛЮБЫХ изменений
- Запускать сервисы (если нужно)
- Открывать страницы в браузере (через curl или проверять доступность)
- Выполнять операции, которые были изменены
- Проверять результат визуально (через описание UI или скриншоты)
- Проверять консоль браузера (F12) на наличие ошибок
- Проверять Network tab на наличие ошибок API запросов

**Чеклист проверки:**
- [ ] Сервисы запущены и работают
- [ ] Страница открывается без ошибок
- [ ] Измененная функциональность работает корректно
- [ ] Нет ошибок в консоли браузера
- [ ] Нет ошибок в Network tab
- [ ] Результат отображается корректно

**Правило:** Не заявлять, что задача завершена, пока не проверено на реальном фронтенде.

### 1.3 Использование скриншотов/описаний UI для понимания текущего состояния

**Проблема:** AI-агент не всегда понимает текущее состояние UI, что приводит к неправильным решениям.

**Решение:**
- Запрашивать скриншоты или описания UI при диагностике проблем
- Использовать описания UI для понимания текущего состояния
- Сравнивать ожидаемое состояние с реальным

**Пример:**
```
Пользователь: "На фронтенде отображается Яндекс у всех доменов"
AI-агент: "Понял проблему. Проверяю логику определения источников..."
```

### 1.4 Создание тестовых сценариев для проверки функциональности

**Проблема:** Нет автоматических тестов для проверки функциональности.

**Решение:**
- Создавать тестовые сценарии для критических функциональностей
- Использовать скрипты для автоматической проверки
- Документировать тестовые сценарии

**Пример тестового сценария:**
```powershell
# Тест определения источников для доменов
$runId = "<run_id>"
$logs = Invoke-RestMethod -Uri "http://127.0.0.1:8000/parsing/runs/$runId/logs"
$domains = Invoke-RestMethod -Uri "http://127.0.0.1:8000/domains/queue?parsingRunId=$runId&limit=1000"

# Проверка, что parsing_logs содержат информацию
if (-not $logs.parsing_logs.google -or -not $logs.parsing_logs.yandex) {
    Write-Host "ERROR: parsing_logs не содержат информацию о Google/Yandex"
    exit 1
}

# Проверка, что источники определяются корректно
# ...
```

## 2. Улучшение понимания структуры проекта

### 2.1 Создание карты проекта с описанием всех файлов и их назначения

**Проблема:** AI-агент не всегда знает, где находится нужный файл или как он работает.

**Решение:**
- Создать карту проекта (`docs/PROJECT_MAP.md`) с описанием всех директорий и ключевых файлов
- Описать назначение каждого файла
- Описать зависимости между файлами

**Структура карты:**
- Backend: роутеры, usecases, adapters, модели
- Frontend: страницы, компоненты, утилиты, типы
- Parser Service: основные модули
- Зависимости между модулями

### 2.2 Автоматический анализ зависимостей между файлами

**Проблема:** При изменении файла не всегда понятно, какие другие файлы могут быть затронуты.

**Решение:**
- Использовать `grep` и `codebase_search` для поиска всех мест использования
- Анализировать зависимости перед изменением
- Предупреждать о потенциальных проблемах

**Команды для анализа:**
```powershell
# Поиск всех мест использования функции
grep -r "functionName" frontend/
codebase_search "Where is functionName used?"

# Поиск всех мест использования типа
grep -r "TypeName" frontend/
```

### 2.3 Создание индекса всех функций и их использования

**Проблема:** Нет централизованного индекса функций и их использования.

**Решение:**
- Создать индекс функций с описанием их назначения и мест использования
- Обновлять индекс при изменении функций
- Использовать индекс для быстрого поиска

### 2.4 Документирование всех критических точек интеграции

**Проблема:** Не все критические точки интеграции задокументированы.

**Решение:**
- Документировать все критические точки интеграции в `docs/CRITICAL_INTEGRATION_POINTS.md`
- Описывать места использования, правила реализации, чеклисты проверки
- Обновлять документацию при изменении функциональности

## 3. Улучшение процесса работы

### 3.1 Создание чеклиста для каждого типа задачи

**Проблема:** Нет стандартизированного процесса для разных типов задач.

**Решение:**
- Создать чеклисты для разных типов задач:
  - Изменение API endpoint
  - Изменение UI компонента
  - Исправление ошибки
  - Добавление новой функциональности
- Использовать чеклисты для обеспечения полноты работы

**Пример чеклиста для изменения API:**
- [ ] Проверить все места использования endpoint
- [ ] Обновить типы в `lib/types.ts`
- [ ] Обновить функции в `lib/api.ts`
- [ ] Обновить компоненты, использующие endpoint
- [ ] Проверить на реальном фронтенде
- [ ] Обновить документацию

### 3.2 Автоматическая проверка всех связанных файлов при изменении

**Проблема:** При изменении файла не всегда проверяются все связанные файлы.

**Решение:**
- Перед изменением файла искать все места использования
- Проверять все связанные файлы
- Предупреждать о потенциальных проблемах

**Команды:**
```powershell
# Поиск всех мест использования
grep -r "functionName\|TypeName\|endpointName" frontend/ backend/
codebase_search "Where is X used?"
```

### 3.3 Предупреждения о потенциальных проблемах перед изменением

**Проблема:** AI-агент не всегда предупреждает о потенциальных проблемах.

**Решение:**
- Анализировать влияние изменений перед их выполнением
- Предупреждать о потенциальных проблемах
- Предлагать альтернативные решения

**Пример:**
```
⚠️ ВНИМАНИЕ: Изменение этой функции может затронуть 5 других файлов:
- frontend/app/page.tsx
- frontend/app/keywords/page.tsx
- ...
Рекомендуется проверить все места использования перед изменением.
```

### 3.4 Автоматическое тестирование изменений

**Проблема:** Нет автоматических тестов для проверки изменений.

**Решение:**
- Создавать тесты для критических функциональностей
- Запускать тесты после изменений
- Использовать скрипты для автоматической проверки

**Команды:**
```powershell
# Проверка импортов Backend
python temp/backend/check_imports.py

# Проверка линтера Frontend
cd frontend/moderator-dashboard-ui
npm run lint

# Проверка всех сервисов
.\scripts\quick-check.ps1 all
```

## 4. Конкретные рекомендации

### 4.1 Перед изменением любого файла

**ОБЯЗАТЕЛЬНО:**
1. Проверить все места использования через `grep` и `codebase_search`
2. Прочитать документацию в `docs/CRITICAL_INTEGRATION_POINTS.md`
3. Проверить состояние системы через `.\scripts\quick-check.ps1 all`
4. Проанализировать влияние изменений

**Пример:**
```powershell
# 1. Поиск всех мест использования
grep -r "functionName" frontend/ backend/

# 2. Проверка документации
# Прочитать docs/CRITICAL_INTEGRATION_POINTS.md

# 3. Проверка состояния системы
.\scripts\quick-check.ps1 all
```

### 4.2 После изменения

**ОБЯЗАТЕЛЬНО:**
1. Запустить проверки (импорты, линтер, quick-check)
2. Проверить на реальном фронтенде
3. Проверить консоль браузера и Network tab
4. Обновить документацию (если нужно)

**Чеклист:**
- [ ] Запущен `.\scripts\quick-check.ps1 all`
- [ ] Проверены импорты (для Backend)
- [ ] Проверен линтер (для Frontend)
- [ ] Проверено на реальном фронтенде
- [ ] Проверена консоль браузера
- [ ] Проверен Network tab
- [ ] Обновлена документация

### 4.3 При диагностике проблем

**ОБЯЗАТЕЛЬНО:**
1. Сначала проверить состояние системы (использовать чеклист из `docs/TROUBLESHOOTING.md`)
2. Проверить логи сервисов
3. Проверить `docs/TROUBLESHOOTING.md` на наличие похожих проблем
4. Только потом искать решение

**Порядок диагностики:**
1. Проверка состояния системы
2. Проверка логов
3. Проверка документации
4. Поиск решения

### 4.4 При документировании

**ОБЯЗАТЕЛЬНО:**
1. Использовать шаблоны (если есть)
2. Следовать структурированному формату
3. Добавлять примеры и команды для проверки
4. Обновлять связанные документы

**Шаблоны:**
- `temp/templates/troubleshooting_template.md` - для документирования ошибок
- `temp/templates/test_hypothesis_template.py` - для тестирования гипотез

## 5. Инструменты для улучшения работы

### 5.1 Скрипты автоматизации

**Использовать:**
- `.\scripts\quick-check.ps1 all` - проверка всех сервисов
- `python temp/backend/check_imports.py` - проверка импортов
- `.\scripts\monitor-services.ps1` - мониторинг сервисов

### 5.2 Документация

**Использовать:**
- `docs/DOCUMENTATION_INDEX.md` - главная точка входа
- `docs/TROUBLESHOOTING.md` - библия ошибок
- `docs/CRITICAL_INTEGRATION_POINTS.md` - критические точки
- `docs/PROJECT_SPECIFICATION.md` - спецификация проекта
- `docs/SOURCE_DETERMINATION_FLOW.md` - потоки данных

### 5.3 Поиск по кодовой базе

**Использовать:**
- `grep` - для точного поиска
- `codebase_search` - для семантического поиска
- `glob_file_search` - для поиска файлов

## 6. Приоритеты рекомендаций

### Высокий приоритет (реализовать в первую очередь)

1. **Обязательная проверка состояния системы перед началом работы**
   - Запускать `.\scripts\quick-check.ps1 all`
   - Проверять все сервисы

2. **Обязательная проверка результатов на реальном фронтенде**
   - Запускать сервисы
   - Открывать страницы
   - Проверять функциональность
   - Проверять консоль и Network tab

3. **Проверка всех мест использования перед изменением**
   - Использовать `grep` и `codebase_search`
   - Проверять документацию

### Средний приоритет

1. **Создание карты проекта**
   - Описание всех директорий и файлов
   - Зависимости между модулями

2. **Создание чеклистов для разных типов задач**
   - Стандартизация процесса работы

3. **Автоматическое тестирование изменений**
   - Создание тестов для критических функциональностей

### Низкий приоритет

1. **Создание индекса функций**
   - Централизованный индекс всех функций

2. **Улучшение предупреждений**
   - Более детальные предупреждения о потенциальных проблемах

## 7. Примеры улучшенного workflow

### Пример 1: Изменение API endpoint

**Старый workflow:**
1. Изменить endpoint
2. Заявить, что готово

**Улучшенный workflow:**
1. Проверить состояние системы (`.\scripts\quick-check.ps1 all`)
2. Найти все места использования endpoint (`grep`, `codebase_search`)
3. Прочитать документацию (`docs/CRITICAL_INTEGRATION_POINTS.md`)
4. Изменить endpoint
5. Обновить типы в `lib/types.ts`
6. Обновить функции в `lib/api.ts`
7. Обновить компоненты
8. Запустить проверки (`quick-check`, `check_imports`, `lint`)
9. Проверить на реальном фронтенде
10. Проверить консоль и Network tab
11. Обновить документацию

### Пример 2: Исправление ошибки

**Старый workflow:**
1. Попытаться исправить ошибку
2. Заявить, что готово

**Улучшенный workflow:**
1. Проверить состояние системы (`.\scripts\quick-check.ps1 all`)
2. Проверить логи сервисов
3. Проверить `docs/TROUBLESHOOTING.md` на наличие похожих проблем
4. Прочитать раздел "ОБЯЗАТЕЛЬНЫЕ ПРОВЕРКИ" из `docs/TROUBLESHOOTING.md`
5. Выполнить чеклист диагностики из `docs/TROUBLESHOOTING.md`
6. Найти причину ошибки
7. Исправить ошибку
8. Запустить проверки
9. Проверить на реальном фронтенде
10. Задокументировать решение в `docs/TROUBLESHOOTING.md`

## 8. Заключение

Эти рекомендации помогут AI-агенту:
- Лучше понимать структуру проекта
- Более эффективно диагностировать проблемы
- Минимизировать участие пользователя в диагностике
- Обеспечить качество работы

**Важно:** Эти рекомендации должны быть интегрированы в `.cursorrules` для автоматического применения.



