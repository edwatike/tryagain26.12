# Настройка работы с профилями Chrome

## Логика работы парсера

### 1. Подключение к Chrome CDP
- Парсер подключается к Chrome через WebSocket URL
- Получает список всех контекстов (профилей) через `browser.contexts`
- Выбирает контекст по индексу (`CHROME_PROFILE_INDEX`)
- **0 = первый профиль, 1 = второй профиль, и т.д.**

### 2. Сбор URL из поисковиков
- Парсер **НЕ переходит** на найденные страницы
- Только собирает URL из результатов поиска
- **Google**: минимум 10 URL (depth >= 2)
- **Yandex**: от 10 до 20 URL (depth >= 2-3)

### 3. Фильтрация
- Исключает внутренние ссылки поисковиков
- Собирает только реальные сайты с `.ru` доменами

## Настройка профиля Chrome

### Способ 1: Через переменную окружения

Создайте файл `.env` в директории `parser_service/`:

```env
CHROME_PROFILE_INDEX=1
```

Где:
- `0` = первый профиль (по умолчанию)
- `1` = второй профиль
- `2` = третий профиль
- и т.д.

### Способ 2: Через изменение config.py

В файле `parser_service/src/config.py` измените:

```python
CHROME_PROFILE_INDEX: int = 1  # Для второго профиля
```

## Запуск Chrome с профилем

Чтобы парсер мог подключиться к конкретному профилю, Chrome должен быть запущен с remote debugging:

```bash
# Для первого профиля (по умолчанию)
chrome.exe --remote-debugging-port=9222

# Для второго профиля
chrome.exe --remote-debugging-port=9222 --user-data-dir="C:\Users\<username>\AppData\Local\Google\Chrome\User Data" --profile-directory="Profile 1"
```

**Важно**: 
- Путь к профилю может отличаться в зависимости от вашей системы
- Чтобы узнать путь к профилю, откройте Chrome и введите `chrome://version/`
- Найдите строку "Путь к профилю" (Profile Path)

## Проверка работы

После настройки перезапустите parser service:

```bash
cd parser_service
python run_api.py
```

В логах вы должны увидеть:
```
Using profile #2 context with X pages
Parser will use profile #2 browser window for parsing!
```

## Примечания

- Если указанный индекс профиля не существует, парсер автоматически использует первый профиль (индекс 0)
- Все открытые профили Chrome доступны через CDP, если Chrome запущен с `--remote-debugging-port=9222`
- Парсер использует существующий контекст профиля, не создает новый






