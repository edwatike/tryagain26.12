# Comet Integration (Extractor)

Скрипт автоматизирует Comet Assistant (sidecar) и извлекает:

- **ИНН**
- **Email для запроса**
- **2 ссылки-источника** (откуда взяты ИНН/email)

Результат и доказательства (скриншоты/снапшоты) сохраняются локально.

## Требования

- Windows
- Python 3.10+
- Установленный Comet
- Comet запущен с включённым CDP на `127.0.0.1:9222`

Важно:

- Во время работы автоматизации **не трогать мышь/клавиатуру**.

## Запуск (в 2 клика)

1) Двойной клик по `START_HERE.bat`

2) Дождаться завершения (окно консоли покажет логи)

Если нужно, чтобы скрипт автоматически закрывал контекст/браузер в конце, установи переменную окружения:

```bat
set COMET_TEST_CLOSE=1
```

## Основной скрипт

- `test_single_domain.py` — прогон по одному домену (сейчас: `metallsnab-nn.ru`).

## Формат ответа ассистента (контролируем скриптом)

Скрипт просит ассистента отвечать строго 4 строками:

```text
ИНН: <10-12 цифр или пусто>
Email: <email или пусто>
Источник1: <https://...>
Источник2: <https://...>
```

## Артефакты и доказательства

Все доказательства сохраняются в `cdp_debug/`:

- Скриншоты открытия ассистента
- Скриншоты ввода промпта и отправки
- Скриншоты ответа
- `*_sidecar_snapshot.json` (DOM-снимок sidecar)

## Частые проблемы

### Ассистент «открылся и закрылся»

Это обычно toggle-хоткей или потеря фокуса.

Скрипт делает ретраи открытия и сохраняет `desktop` + `sidecar` скриншоты по каждой попытке.
Смотри последние файлы в `cdp_debug` по шаблонам:

- `*_assistant_open_attempt_*_desktop.png`
- `*_assistant_attempt_*_sidecar_opened.png`
- `*_input_not_found_sidecar_snapshot.json`

## Очистка папки (важно)

В каталоге есть много экспериментальных `.bat`, логов и скриншотов.

Я могу подготовить «чистую» структуру и скрипт очистки, но **удаление файлов выполняй только после подтверждения списка KEEP/REMOVE**.
