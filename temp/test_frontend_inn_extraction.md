# Инструкция по тестированию извлечения ИНН на фронтенде

## Предварительные требования

1. **Backend должен быть запущен и перезагружен** (чтобы подхватить новый роутер)
2. **Frontend должен быть запущен**
3. **Ollama Service должен быть запущен** (опционально, но рекомендуется)

## Шаги для проверки

### 1. Запустите все сервисы

```powershell
# Если сервисы не запущены:
.\start-all-tabby.bat

# Или запустите Ollama Service отдельно:
cd ollama_inn_extractor
python run_api.py
```

### 2. Откройте страницу деталей парсинга

1. Откройте браузер: `http://localhost:3000`
2. Перейдите на страницу с результатами парсинга (любой завершенный run)
3. URL должен быть вида: `http://localhost:3000/parsing-runs/{runId}`

### 3. Проверьте чекбоксы

1. **Должны быть видны чекбоксы** слева от каждого домена в списке
2. **Кликните на чекбокс** - домен должен выделиться
3. **Проверьте счетчик** "Выбрано: X" вверху списка

### 4. Проверьте кнопки

1. **Кнопка "Выбрать все"** - должна выделить все домены
2. **Кнопка "Снять выбор"** - должна снять выделение со всех доменов
3. **Кнопка "Копировать (X)"** - должна появиться при выборе доменов
   - Кликните - домены должны скопироваться в буфер обмена
   - Должно появиться уведомление "Скопировано X доменов"

### 5. Проверьте извлечение ИНН

1. **Выберите несколько доменов** (чекбоксами)
2. **Кликните "Извлечь ИНН (X)"**
3. **Должно открыться модальное окно** с заголовком "Результаты извлечения ИНН"
4. **Должен отображаться прогресс**: "Обработка: X из Y доменов"
5. **После завершения** должны отобразиться результаты:
   - Для каждого домена: статус, ИНН (если найден)
   - Кнопка "Показать" для просмотра пруфов (если ИНН найден)

### 6. Проверьте пруфы (контекст)

1. **Для домена с найденным ИНН** кликните на детали
2. **Должны отобразиться**:
   - URL, откуда взят ИНН (кликабельная ссылка)
   - Метод извлечения (regex/ollama)
   - Уровень уверенности (высокая/средняя/низкая)
   - Контекст - фрагмент текста вокруг ИНН

### 7. Проверьте обработку ошибок

1. **Выберите домен, которого нет в базе** (если возможно)
2. **Должна отобразиться ошибка** с описанием проблемы
3. **Остальные домены должны продолжить обработку**

## Возможные проблемы

### Endpoint возвращает 404

**Решение**: Перезапустите Backend, чтобы подхватить новый роутер:
```powershell
# Остановите Backend (Ctrl+C) и запустите снова
cd backend
uvicorn app.main:app --reload --host 127.0.0.1 --port 8000
```

### Ollama Service не запущен

**Решение**: Запустите Ollama Service:
```powershell
cd ollama_inn_extractor
python run_api.py
```

### Ошибки в консоли браузера

1. Откройте DevTools (F12)
2. Проверьте вкладку Console на наличие ошибок
3. Проверьте вкладку Network на наличие failed запросов

## Ожидаемое поведение

- ✅ Чекбоксы отображаются и работают
- ✅ Кнопки появляются при выборе доменов
- ✅ Копирование работает
- ✅ Извлечение ИНН запускается и показывает прогресс
- ✅ Результаты отображаются с пруфами
- ✅ Пруфы содержат URL, контекст, метод и уверенность





