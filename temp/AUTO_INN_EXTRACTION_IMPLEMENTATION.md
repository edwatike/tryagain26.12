# ✅ Реализация автоматического извлечения ИНН

## Что реализовано:

### 1. ✅ Автоматическое извлечение при выборе домена
- При выборе домена через чекбокс автоматически запускается извлечение ИНН
- Функция `extractINNForDomain` вызывается при добавлении домена в `selectedDomains`
- Проверяется кэш перед запуском извлечения

### 2. ✅ Отображение найденных ИНН
- Найденные ИНН отображаются **желтым цветом** (`bg-yellow-200 hover:bg-yellow-300`)
- ИНН является **кликабельной ссылкой** на пруф (URL, откуда взят ИНН)
- При наведении показывается tooltip с контекстом
- Иконка внешней ссылки (`ExternalLink`)

### 3. ✅ Кэширование результатов
- Результаты сохраняются в `localStorage` с ключом `inn-results-{runId}`
- При загрузке страницы кэш восстанавливается
- Кэш обновляется при каждом новом результате

### 4. ✅ Минимальные логи
- Логирование только при ошибках (в консоль)
- Индикатор "Извлечение..." показывается во время обработки
- Никаких toast-уведомлений при автоматическом извлечении

### 5. ✅ Правило о подтверждении понимания
- Добавлено в `.cursorrules` как обязательное правило
- После каждого сообщения пользователя нужно подтверждать понимание

## Как это работает:

1. **Пользователь выбирает домен** через чекбокс
2. **Автоматически запускается** `extractINNForDomain(domain)`
3. **Проверяется кэш** - если результат уже есть, извлечение не запускается
4. **Домен помечается** как обрабатываемый (`extractingDomains`)
5. **Выполняется запрос** к Backend через `extractINNBatch([domain])`
6. **Результат сохраняется** в `innResultsMap` (только если ИНН найден)
7. **Результат отображается** желтым бейджем с ссылкой на пруф
8. **Кэш обновляется** в localStorage

## Визуальное оформление:

```tsx
<a
  href={proof.url}
  target="_blank"
  rel="noopener noreferrer"
  className="ml-1 px-2 py-0.5 bg-yellow-200 hover:bg-yellow-300 text-yellow-900 rounded text-xs font-semibold underline transition-colors"
  title="ИНН найден: 1234567890. Контекст: ..."
>
  ИНН: 1234567890
  <ExternalLink className="h-3 w-3 inline ml-1" />
</a>
```

## Тестирование:

1. Откройте `http://localhost:3000/parsing-runs/{runId}`
2. Выберите домен через чекбокс
3. Должен появиться индикатор "Извлечение..."
4. После завершения должен появиться желтый бейдж с ИНН
5. Клик по бейджу должен открыть URL пруфа в новой вкладке

## Измененные файлы:

- `frontend/moderator-dashboard-ui/app/parsing-runs/[runId]/page.tsx`
  - Добавлено состояние `innResultsMap` и `extractingDomains`
  - Добавлена функция `extractINNForDomain`
  - Обновлена функция `toggleDomainSelection`
  - Добавлены useEffect для кэширования
  - Добавлено отображение ИНН в UI

- `.cursorrules`
  - Добавлено правило о подтверждении понимания





